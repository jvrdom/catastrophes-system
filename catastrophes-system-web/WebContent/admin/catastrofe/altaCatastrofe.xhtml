<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:body>
  <ui:composition template="/admin/template/layout.xhtml">
	  <ui:define name="content">
	  	<div class="row">
	  		<div class="col-xs-6">
	  			<h:form enctype="multipart/form-data" class = "form-horizontal">
	  				<div class="form-group">
	  				<div class="col-sm-12">
			  				<p:fileUpload value="#{catastrofes.file}" mode="simple" styleClass="btn btn-success form-control"/>
						</div>
					</div>
	  				<div class="form-group">
			  			<div class="col-sm-12">	
			                <p:inputText id="inputname" value="#{catastrofes.nombre}" required="true" label="Name" styleClass="form-control">
			                    <f:validateLength minimum="2" />
			                </p:inputText>
			                <p:watermark for="inputname" value="Nombre de Evento" id="watermarkName" />
			            </div>
	                </div>
	                <div class="form-group">
			  			<div class="col-sm-12">	
			                <p:inputText id="inputdescripcion" value="#{catastrofes.descripcion}" required="true" label="Name" styleClass="form-control"/>
			                <p:watermark for="inputdescripcion" value="Descripcion" id="watermarkDesc" />
			            </div>
	                </div>
	                <div class="form-group">
			  			<div class="col-sm-12">
			  				<div class="input-group">	
			                	<p:inputText id="inputdireccion" value="#{catastrofes.direccion}" required="true" label="Name" styleClass="form-control"/>
			                	<h:inputHidden value="#{catastrofes.latLng}" id='coord'/>
			                	<span class="input-group-btn">
						        	<button class="btn btn-default" type="button" onclick="codeAddress()">
						        		<span class="glyphicon glyphicon-map-marker"/>
						        	</button>
						        </span>
						        <p:watermark for="inputdireccion" value="Direccion" id="watermarkDireccion" />
			                </div>
			            </div>
	                </div>
	                <div class="form-group">
	                </div>
                	<h:commandButton value="Ingresar CatÃ¡strofe" action="#{catastrofes.altaCatastrofe}" class="pull-right btn btn-success"></h:commandButton>
        		</h:form>
			</div>
			<div class="col-xs-6" id="mapa" style="height: 300px;"></div>
		</div>
		<div class="row">
			<div class="col-xs-6">
				<p>Panel de planes de emergencia y/o gestion</p>
				<h:form enctype="multipart/form-data">
					<p:fileUpload fileUploadListener="#{catastrofes.handleFileUpload}" mode="advanced" dragDropSupport="false"
                  	multiple="true" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
                </h:form>
			</div>
		</div>
		<script type="text/javascript">
			var map;
			var geocoder;
			var circle;

			function initialize(){
				 geocoder = new google.maps.Geocoder();
				 var mapOptions = {
					 center: new google.maps.LatLng(-34.904375,-56.166414),
					 zoom: 13,
					 mapTypeId: google.maps.MapTypeId.ROADMAP,
					 mapTypeControl: true,
					 mapTypeControlOptions: {
					 	style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
				 	 }
				 };

				 map = new google.maps.Map(document.getElementById('mapa'),mapOptions);
			}

			function codeAddress(){
		          var address = document.getElementById('j_idt29:inputdireccion').value;
		          var bounds = new google.maps.LatLngBounds();
		          geocoder.geocode( { 'address': address}, function(results, status) {
		            if (status == google.maps.GeocoderStatus.OK) {
		              map.setCenter(results[0].geometry.location);
		              var latLng = results[0].geometry.location;
		              		              
		              var circleOptions = {
		            	strokeColor: '#FF0000',
		            	strokeOpacity: 0.8,
		            	strokeWeight: 2,
		            	fillColor: '#FF0000',
		            	fillOpacity: 0.35,
		            	map: map,
		            	center: results[0].geometry.location,
		            	radius: Math.sqrt(10) * 100
					  }
					  
		              bounds.extend(latLng);
		              map.fitBounds(bounds);
		              var zoom = map.getZoom();
		              map.setZoom(zoom > 15 ? 15 : zoom);
		              
		              circle = new google.maps.Circle(circleOptions);
		          
		              document.getElementById('j_idt29:coord').value = circle.getCenter();
		            } else {
		              alert('Geocode was not successful for the following reason: ' + status);
		            }
		          });
		        }

			google.maps.event.addDomListener(window, 'load', initialize);
			
  		</script>
	  </ui:define>
  </ui:composition>
</h:body>
</html>