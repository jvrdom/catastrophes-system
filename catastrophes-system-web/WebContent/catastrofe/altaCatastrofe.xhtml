<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:body>
  <ui:composition template="/template/layout.xhtml">
	  <ui:define name="content">
	  	<div class="row">
	  		<div class="col-xs-6">
	  			<h:form enctype="multipart/form-data" class = "form-horizontal">
	  				<div class="form-group">
	  					<label for="inputicon" class="col-sm-2 control-label">Icono:</label>
	  					<div class="col-sm-10">
			  				<div class="fileinput fileinput-new" data-provides="fileinput">
							  <div class="fileinput-new thumbnail" style="width: 121px; height: 100px;">
							    <h:graphicImage name="images/icon.png" />
							  </div>
							  <div class="fileinput-preview fileinput-exists thumbnail" style="max-width: 121px; max-height: 100px;"></div>
							  <div>
							    <span class="btn btn-default btn-file"><span class="fileinput-new">Seleccionar Icono</span><span class="fileinput-exists">Cambiar</span><input id="icon" type="file" name="icon" value="#{catastrofes.finalPath}"/></span>
							    <a href="#" class="btn btn-default fileinput-exists" data-dismiss="fileinput">Remover</a>
							    <h:inputHidden value="#{catastrofes.finalPath}" id='path'/>
							  </div>
							</div>
						</div>
					</div>
	  				<div class="form-group">
		  				<label for="inputname" class="col-sm-2 control-label">Nombre:</label>
			  			<div class="col-sm-10">	
			                <p:inputText id="inputname" value="#{catastrofes.nombre}" required="true" label="Name" styleClass="form-control">
			                    <f:validateLength minimum="2" />
			                </p:inputText>
			            </div>
	                </div>
	                <div class="form-group">
		  				<label for="inputdescripcion" class="col-sm-2 control-label">Descripcion:</label>
			  			<div class="col-sm-10">	
			                <p:inputText id="inputdescripcion" value="#{catastrofes.descripcion}" required="true" label="Name" styleClass="form-control"/>
			            </div>
	                </div>
	                <div class="form-group">
		  				<label for="inputdireccion" class="col-sm-2 control-label">Dirección:</label>
			  			<div class="col-sm-10">
			  				<div class="input-group">	
			                	<p:inputText id="inputdireccion" value="#{catastrofes.direccion}" required="true" label="Name" styleClass="form-control"/>
			                	<h:inputHidden value="#{catastrofes.latLng}" id='coord'/>
			                	<span class="input-group-btn">
						        	<button class="btn btn-default" type="button" onclick="codeAddress()">
						        		<span class="glyphicon glyphicon-map-marker"/>
						        	</button>
						        </span>
			                </div>
			            </div>
	                </div>
                	<h:commandButton value="Ingresar Catástrofe" action="#{catastrofes.altaCatastrofe}" class="pull-right btn btn-success"></h:commandButton>
        		</h:form>
			</div>
			<div class="col-xs-6" id="mapa" style="height: 300px;"></div>
		</div>
		<script type="text/javascript">
			var map;
			var geocoder;

			function initialize(){
				 geocoder = new google.maps.Geocoder();
				 var mapOptions = {
					 center: new google.maps.LatLng(-34.904375,-56.166414),
					 zoom: 13,
					 mapTypeId: google.maps.MapTypeId.ROADMAP,
					 mapTypeControl: true,
					 mapTypeControlOptions: {
					 	style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
				 	 }
				 };

				 map = new google.maps.Map(document.getElementById('mapa'),mapOptions);
			}

			function codeAddress(){
		          var address = document.getElementById('j_idt24:inputdireccion').value;
		          var bounds = new google.maps.LatLngBounds();
		          geocoder.geocode( { 'address': address}, function(results, status) {
		            if (status == google.maps.GeocoderStatus.OK) {
		              map.setCenter(results[0].geometry.location);
		              var latLng = results[0].geometry.location;
		              var marker = new google.maps.Marker({
		                  map: map,
		                  animation: google.maps.Animation.DROP,
		                  draggable: true,
		                  position: results[0].geometry.location,
		              });
		              bounds.extend(latLng);
		              map.fitBounds(bounds);
		              var zoom = map.getZoom();
		              map.setZoom(zoom > 15 ? 15 : zoom);
		              google.maps.event.addListener(marker, 'click', function() {
		                infowindow.open(map,marker);
		              });
		              if(marker.getDraggable() == true) {
		                google.maps.event.addListener(
		                    marker,
		                    'drag',
		                    function() {
		                        document.getElementById('j_idt24:coord').value = marker.getPosition();
		                    }
		                );
		              }
		              document.getElementById('j_idt24:coord').value = marker.getPosition();
		            } else {
		              alert('Geocode was not successful for the following reason: ' + status);
		            }
		          });
		        }

			google.maps.event.addDomListener(window, 'load', initialize);

			document.getElementById("j_idt24:path").value = document.getElementById("icon").value;
			
  		</script>
	  </ui:define>
  </ui:composition>
</h:body>
</html>